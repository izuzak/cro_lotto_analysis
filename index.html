<html>
  <head>
    <script type="text/javascript" src="http://code.jquery.com/jquery-latest.js"></script>
    <script type="text/javascript" src="http://people.iola.dk/olau/flot/jquery.flot.js"></script>
    
    <link rel="stylesheet" href="http://ghusse.github.com/jQRangeSlider/stable/css/dev.css">  
    <link rel="stylesheet" href="http://ghusse.github.com/jQRangeSlider/stable/demo/style.css">  
    <link rel="stylesheet" href="http://ghusse.github.com/jQRangeSlider/stable/demo/lib/jquery-ui/css/smoothness/jquery-ui-1.8.10.custom.css">  

    <script src="http://ghusse.github.com/jQRangeSlider/stable/demo/lib/jquery-ui/js/jquery-ui-1.8.10.custom.min.js"></script>
    <script src="http://ghusse.github.com/jQRangeSlider/stable/jQRangeSlider.js"></script>
    <script src="http://ghusse.github.com/jQRangeSlider/stable/jQDateRangeSlider.js"></script>
  </head>
  <body>
    <div style='width:800px; display:block; margin-left:auto; margin-right:auto;'>
    <h1> Croatian lottery randomness analysis </h1>
    <div> 
      <p> This Web application visually displays the randomness in two Croatian lottery systems: the 6/45 and 7/39 system. The goal of the application is to visually explore the degree of uniformity of the drawn numbers. The application uses data made publicly available by the Croatian lottery <a href="https://www.lutrija.hr/cms/Loto7Arhiva">here</a> (for 7/39) and <a href="https://www.lutrija.hr/cms/Loto6Arhiva">here</a> (for 6/45).</p>
      <p>The <strong>application</strong> is developed by <a href="http://ivanzuzak.info">Ivan Zuzak</a> and is available under the <a href="https://github.com/izuzak/cro_lotto_analysis/blob/master/LICENSE.markdown">Apache 2.0 License</a>. I have no claim over the <strong>data</strong> provided by the Croatian lottery. For more information and the source code of the application, visit the <a href="https://github.com/izuzak/cro_lotto_analysis/">GitHub repository</a>.</p>
    </div>

    <h2> Loto 7/39 </h2>
    <div id="7_39_analysis">
    </div>

    <h2> Loto 6/45 </h2>
    <div id="6_45_analysis">
    </div>
    
    <script type="text/javascript">    
      function showTooltip(x, y, contents) {
        $('<div id="tooltip">' + contents + '</div>').css( {
          position: 'absolute',
          display: 'none',
          top: y + 5,
          left: x + 5,
          border: '1px solid #fdd',
          padding: '2px',
          'background-color': '#fee',
          opacity: 0.80
        }).appendTo("body").fadeIn(200);
      }

      var previousPoint = null;

      function plothover(event, pos, item) {
        if (item) {
          if (previousPoint !== item.dataIndex) {
            previousPoint = item.dataIndex;
            
            $("#tooltip").remove();
            
            var x = event.data.data[item.datapoint[0]];
            var y = item.datapoint[1];
            
            showTooltip(item.pageX, item.pageY, "Number " + x.toString() + " was drawn " + y.toString() + " times.");
          }
        } else {
          $("#tooltip").remove();
          previousPoint = null;            
        }
      }

      var data = {};
      function fetchData(url, name, elem_id) {
        $.get(url, function(d) {
          var lines = d.split("\n");
          data[name] = {};
          var minDate = null; 
          var maxDate = null;

          data[name].items = [];
          for (var i=0; i<lines.length; i++) {
            var item_data = lines[i].split(";");
            var item = {
              date : new Date(item_data.shift()),
              numbers : item_data
            };
            
            if (minDate === null) {
              minDate = item.date;
              maxDate = item.date;
            } else {  
              if (item.date < minDate) {
                minDate = item.date;
              }
              
              if (item.date > maxDate) {
                maxDate = item.date;
              }
            }
            
            data[name].items.push(item);
          }
          
          $("#" + elem_id).append($("<div id='" + elem_id + "_0" + "' style='width:800px;height:30px;margin-top:30;'></div>"));
          $("#" + elem_id).append("<p>Sorted by numbers:</p>");
          $("#" + elem_id).append($("<div id='" + elem_id + "_1" + "' style='width:800px;height:200px'></div>"));
          $("#" + elem_id).append("<p>Sorted by frequency:</p>");
          $("#" + elem_id).append($("<div id='" + elem_id + "_2" + "' style='width:800px;height:200px'></div>"));
          $("#" + elem_id).append($("<div id='" + elem_id + "_3" + "' style='width:800px;'></div>"));
        
          $("#" + elem_id + "_0").dateRangeSlider({
            defaultValues:{min:minDate, max:maxDate},
            bounds:{min:minDate, max:maxDate},
            wheelMode: null,
            wheelSpeed: 8,
            arrows: false,
            valueLabels: "show",
            formatter: function(value){
              var month = value.getMonth() + 1;
              var day = value.getDate();
              return "" + value.getFullYear() + "-" + (month < 10 ? "0" + month : month) + "-" + (day < 10 ? "0" + day : day);
            },
            durationIn: 0,
            durationOut: 400,
            delayOut: 200
          }).bind("valuesChanged", function(event, ui) { refreshView(ui.values.min, ui.values.max, name, elem_id); }).addClass("ui-rangeSlider-dev");
          
          refreshView(minDate, maxDate, name, elem_id);
        });
      }

      fetchData("http://izuzak.github.com/cro_lotto_analysis/7_39.txt", "7_39", "7_39_analysis");
      fetchData("http://izuzak.github.com/cro_lotto_analysis/6_45.txt", "6_45", "6_45_analysis");
  
      function refreshView(startDate, endDate, name, elem_id) {
        var d = data[name].items;
        var n = {};
        var k = [];
        var z = [];
        
        for (var i=1; i<=parseInt(name.split("_")[1]); i++) {
          n[i] = 0;
        }

        for (var i=0; i<d.length; i++) {
          if (d[i].date <= endDate && startDate <= d[i].date ) {
            for (var j=0; j<d[i].numbers.length; j++) {              
              n[d[i].numbers[j]] = n[d[i].numbers[j]] + 1;
            }
          }
        }
        
        for (var key in n) {
          k.push([parseInt(key), n[key], {num : key, times : n[key].toString()}]);
          z.push([parseInt(key), n[key], {num : key, times : n[key].toString()}]);
        }
        
        k.sort(function(e1, e2) {
          if (e1[0] > e2[0]) {
            return 1;
          } else if (e1[0] === e2[0]) {
            return 0;
          } else {
            return -1;
          }
        });
          
        z.sort(function(e1, e2) {
          if (e1[1] > e2[1]) {
            return 1;
          } else if (e1[1] === e2[1]) {
            return 0;
          } else {
            return -1;
          }
        });
        
        var mapping1 = {};
        var mapping2 = {};
        
        for (var i=0; i<z.length; i++) {
          mapping1[(z[i][0]).toString()] = (z[i][0]).toString();
          mapping2[(i+1).toString()] = (z[i][0]).toString();
          z[i][0] = i+1;
        }

        var p1 = $.plot($("#" + elem_id + "_1"), [{data : k}],
          {
             series: {
               lines: { show: true },
               points: { show: true }
             },
             grid: { hoverable: true, clickable: true }
          }
        );

        var p2 = $.plot($("#" + elem_id + "_2"), [ {data: z} ],
          {
            series: {
              lines: { show: true },
              points: { show: true }
            },
            grid: { hoverable: true, clickable: true }
          }
        );
        
        $("#" + elem_id + "_1").unbind().bind("plothover", {data : mapping1}, plothover);
        $("#" + elem_id + "_2").unbind().bind("plothover", {data : mapping2}, plothover);

        $("#" + elem_id + "_3").html("");
        var nums = "<p><b>Numbers sorted by frequency:</b> ";
        for (var i=0; i<z.length; i++) {
          nums += "<b>" + mapping2[i+1].toString() + "</b>" + " (" + "<i>" + z[i][1] + "</i>) ";
        }
        nums += "</p>"
        $("#" + elem_id + "_3").append(nums);

        $("#" + elem_id + "_3").append("<p> <b> Top/bottom frequency ratio</b> = " + (z[z.length-1][1] / z[0][1]).toString());
      }
    </script>

    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-25522374-1']);
      _gaq.push(['_setDomainName', 'auto']);
      _gaq.push(['_setAllowLinker', true]);
      _gaq.push(['_trackPageview']);
    
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript';
        ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
      })();
    </script>    
    </div>
  </body>
</html>
